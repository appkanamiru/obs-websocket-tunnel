(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4745:e=>{e.exports={style:{fontFamily:"'Rubik', 'Rubik Fallback'",fontStyle:"normal"},className:"__className_752ba5"}},5948:(e,t,n)=>{"use strict";n.d(t,{default:()=>c,e:()=>u});var r=n(5155),o=n(2115),s=n(7730);let a={password:"",port:"4455",agentToken:"",agentEndpoint:"ws://localhost:9090",obsStatus:"disconnected",agentStatus:"disconnected",savePassword:()=>{},savePort:()=>{},saveAgentToken:()=>{},saveAgentEndpoint:()=>{}},l=(0,o.createContext)(a);function c(e){let{children:t}=e,[n,c]=(0,o.useState)(a.password),[u,d]=(0,o.useState)(a.port),[i,g]=(0,o.useState)(a.agentToken),[b,v]=(0,o.useState)(a.agentEndpoint),[S,E]=(0,o.useState)(a.obsStatus),[m,p]=(0,o.useState)(a.agentStatus),f=(0,o.useRef)(!1),k=(0,o.useRef)(null),h=(0,o.useRef)(null),w=(0,o.useRef)(void 0),R=(0,o.useRef)(void 0),I=(0,o.useCallback)(()=>{var e;clearInterval(R.current),null==(e=h.current)||e.close(),h.current=null,clearInterval(R.current)},[]),C=(0,o.useCallback)(()=>{if(I(),0===i.length||!(0,s.r)(b))return;p("connecting");let e=new WebSocket("".concat(b,"?token=").concat(i));e.addEventListener("open",()=>{console.log("SERVER open"),clearInterval(R.current),h.current=e,p("connected")}),e.addEventListener("error",()=>{console.log("SERVER error")}),e.addEventListener("close",e=>{console.log("SERVER close",e.code,e.reason),h.current=null,R.current=setTimeout(()=>{C()},5e3),p("disconnected")}),e.addEventListener("message",e=>{var t;console.log("SERVER message"),null==(t=k.current)||t.send(e.data)})},[b,i,I]),O=(0,o.useCallback)(()=>{var e;I(),clearTimeout(w.current),null==(e=k.current)||e.close(),k.current=null,clearTimeout(w.current)},[I]),P=(0,o.useCallback)(()=>{O(),E("connecting");let e=new WebSocket("ws://localhost:".concat(u));e.addEventListener("open",()=>{console.log("OBS open"),clearTimeout(w.current),k.current=e}),e.addEventListener("error",()=>{console.log("OBS error")}),e.addEventListener("close",e=>{console.log("OBS close",e.code,e.reason),O(),w.current=setTimeout(()=>{P()},5e3),E("disconnected")}),e.addEventListener("message",t=>{let n;console.log("OBS message");try{n=function(e){let t;try{t=JSON.parse(e)}catch(e){throw Error("Invalid JSON")}if("object"!=typeof t||null===t)throw Error("Invalid message");let{op:n,d:r}=t;if(!("number"==typeof n&&[0,1,2,3,5,6,7,8,9].includes(n)))throw Error("Invalid op code");return{op:n,d:r}}(t.data)}catch(e){return}switch(n.op){case 0:e.send(JSON.stringify(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{op:1,d:{rpcVersion:e}}}()));break;case 2:C(),E("connected");break;case 5:case 7:var r;null==(r=h.current)||r.send(t.data)}})},[C,O,u]),T=(0,o.useCallback)(e=>{localStorage.setItem("obsPassword",e),c(e)},[]),y=(0,o.useCallback)(e=>{localStorage.setItem("obsPort",e),d(e)},[]),L=(0,o.useCallback)(e=>{localStorage.setItem("agentToken",e),g(e)},[]),N=(0,o.useCallback)(e=>{localStorage.setItem("agentEndpoint",e),v(e)},[]);(0,o.useEffect)(()=>{let e=localStorage.getItem("obsPassword")||a.password,t=localStorage.getItem("obsPort")||a.port,n=localStorage.getItem("agentToken")||a.agentToken,r=localStorage.getItem("agentEndpoint")||a.agentEndpoint;c(e),d(t),g(n),v(r),f.current=!0},[]),(0,o.useEffect)(()=>{f.current&&P()},[P]);let _=(0,o.useMemo)(()=>({password:n,port:u,agentToken:i,obsStatus:S,agentStatus:m,agentEndpoint:b,savePassword:T,savePort:y,saveAgentToken:L,saveAgentEndpoint:N}),[b,m,i,S,n,u,N,L,T,y]);return(0,r.jsx)(l.Provider,{value:_,children:t})}function u(){let e=(0,o.useContext)(l);if(!e)throw Error("useObs must be use within ObsProvider");return e}},7730:(e,t,n)=>{"use strict";function r(e){let t=Number(e);return/^\d+$/.test(e)&&t>=0&&t<=65535}function o(e){try{let t=new URL(e),n="ws:"===t.protocol||"wss:"===t.protocol,o=!!t.hostname,s=""===t.port||r(t.port);return n&&o&&s}catch(e){return!1}}n.d(t,{Q:()=>r,r:()=>o})},9044:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,4745,23)),Promise.resolve().then(n.t.bind(n,9324,23)),Promise.resolve().then(n.bind(n,5948))},9324:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[688,441,684,358],()=>t(9044)),_N_E=e.O()}]);